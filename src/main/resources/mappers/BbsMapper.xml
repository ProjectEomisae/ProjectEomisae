<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dev.dmchoi.eomisae.mappers.IBbsMapper">
    <select id="selectArticleCountTotalByUserIndex"
            resultType="_int">
        SELECT COUNT(0)
        FROM `eomisae_article`.`articles`
        WHERE `user_index` = #{userIndex}
    </select>

    <select id="selectArticleCountTotalByBoardIndex"
            resultType="_int">
        SELECT COUNT(0)
        FROM `eomisae_article`.`articles`
        WHERE `board_index` = #{boardIndex}
    </select>

    <select id="selectArticleCountTotalByBoardIndexAndCategory"
            resultType="_int">
        SELECT COUNT(0)
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = #{boardIndex}
          AND `category_index` = #{categoryIndex}
    </select>

    <select id="selectCategories"
            resultType="dev.dmchoi.eomisae.entities.bbs.CategoryEntity">
        SELECT `index`       AS `index`,
               `name`        AS `name`,
               `board_index` AS `boardIndex`
        FROM `eomisae_article`.`categories`
        ORDER BY `index`
    </select>

    <select id="getCountByTitleContent"
            resultType="_int">
        SELECT COUNT(0)
        FROM `eomisae_article`.`articles`
        WHERE `board_index` = #{boardIndex}
          AND (`title` LIKE CONCAT('%', #{keyword}, '%')
            OR `content` LIKE CONCAT('%', #{keyword}, '%'))
    </select>
    <select id="getCountByTitle"
            resultType="_int">
        SELECT COUNT(0)
        FROM `eomisae_article`.`articles`
        WHERE `board_index` = #{boardIndex}
          AND `title` LIKE CONCAT('%', #{keyword}, '%')
    </select>
    <select id="getCountByContent"
            resultType="_int">
        SELECT COUNT(0)
        FROM `eomisae_article`.`articles`
        WHERE `board_index` = #{boardIndex}
          AND `content` LIKE CONCAT('%', #{keyword}, '%')
    </select>

    <select id="getCountByComment"
            resultType="_int">
        SELECT COUNT(0)
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
        WHERE `board_index` = #{boardIndex}
          AND `comment`.`content` LIKE CONCAT('%', #{keyword}, '%')
    </select>
    <select id="getCountByNickname"
            resultType="_int">
        SELECT COUNT(0)
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
        WHERE `board_index` = #{boardIndex}
          AND `user`.`nickname` LIKE CONCAT('%', #{keyword}, '%')
    </select>

    <select id="selectArticlesForAll"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
    </select>

    <select id="selectArticlesForNo"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = 24
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
    </select>

    <select id="selectArticlesForUserIndex"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `user`.`index` = #{index}
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
        LIMIT #{count} OFFSET #{offset}
    </select>

    <select id="selectArticlesForBoardList"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = #{boardIndex}
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
        LIMIT #{count} OFFSET #{offset}
    </select>

    <select id="selectArticlesForBoardListByCategory"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = #{boardIndex}
          AND `category_index` = #{categoryIndex}
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
        LIMIT #{count} OFFSET #{offset}
    </select>

    <select id="searchByTitleContent"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = #{boardIndex}
          AND (`article`.`title` LIKE CONCAT('%', #{keyword}, '%')
            OR `article`.`content` LIKE CONCAT('%', #{keyword}, '%'))
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
        LIMIT #{count} OFFSET #{offset}
    </select>
    <select id="searchByTitle"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = #{boardIndex}
          AND `article`.`title` LIKE CONCAT('%', #{keyword}, '%')
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
        LIMIT #{count} OFFSET #{offset}
    </select>
    <select id="searchByContent"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,

               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = #{boardIndex}
          AND `article`.`content` LIKE CONCAT('%', #{keyword}, '%')
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
        LIMIT #{count} OFFSET #{offset}
    </select>

    <select id="searchByComment"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = #{boardIndex}
          AND `comment`.`content` LIKE CONCAT('%', #{keyword}, '%')
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
        LIMIT #{count} OFFSET #{offset}
    </select>

    <select id="searchByNickname"
            resultType="dev.dmchoi.eomisae.dtos.bbs.BoardListArticleDto">
        SELECT `article`.`index`          AS `index`,
               `article`.`user_index`     AS `userIndex`,
               `article`.`board_index`    AS `boardIndex`,
               `article`.`written_at`     AS `writtenAt`,
               `article`.`title`          AS `title`,
               `article`.`url`            AS `url`,
               `article`.`content`        AS `content`,
               `article`.`view`           AS `view`,
               `article`.`like`           AS `like`,
               `article`.`buy`            AS `buy`,
               `article`.`category_index` AS `categoryIndex`,
               `article`.`blind_status`   AS `blindStatus`,
               `user`.`nickname`          AS `userNickname`,
               `user`.`level`             AS `level`,
               `user`.`point`             AS `point`,
               COUNT(`comment`.`index`)   AS `commentCount`
        FROM `eomisae_article`.`articles` AS `article`
                 LEFT JOIN `eomisae_member`.`users` AS `user` ON article.user_index = user.`index`
                 LEFT JOIN `eomisae_comment`.`comments` AS `comment` ON article.`index` = comment.article_index
                 LEFT JOIN `eomisae_article`.`categories` AS `category` ON article.category_index = category.`index`
        WHERE `article`.`board_index` = #{boardIndex}
          AND `user`.`nickname` LIKE CONCAT('%', #{keyword}, '%')
        GROUP BY `article`.`index`
        ORDER BY `article`.`index` DESC
        LIMIT #{count} OFFSET #{offset}
    </select>

    <select id="selectBoardByUrlName"
            resultType="dev.dmchoi.eomisae.entities.bbs.BoardEntity">
        SELECT `index`         AS `index`,
               `id`            AS `id`,
               `name`          AS `name`,
               `urlName`       AS `urlName`,
               `list_level`    AS `listLevel`,
               `read_level`    AS `readLevel`,
               `write_level`   AS `writeLevel`,
               `comment_level` AS `commentLevel`
        FROM `eomisae_board`.`boards`
        WHERE `urlName` = #{urlName}
    </select>
</mapper>